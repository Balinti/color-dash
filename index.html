<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Color Dash - Free HTML5 Game</title>
<meta name="description" content="Play Color Dash - Run through color gates matching your current color. Tap to switch between colors. Speed increases every 10 points.">
<meta name="theme-color" content="#1a1a2e">
<meta property="og:type" content="website">
<meta property="og:title" content="Color Dash - Split Decision">
<meta property="og:description" content="Two lanes, two colors, one tap to swap. Match your lane color to the gate and hit the center for perfect combos!">
<meta property="og:url" content="https://balinti.github.io/color-dash/">
<meta property="og:image" content="https://balinti.github.io/color-dash/og.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Color Dash - Split Decision">
<meta name="twitter:description" content="Two lanes, two colors, one tap to swap. Match your lane color to the gate and hit the center for perfect combos!">
<meta name="twitter:image" content="https://balinti.github.io/color-dash/og.png">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0a0a1a;font-family:system-ui,-apple-system,sans-serif}
body{display:flex;justify-content:center;align-items:center}
#gc{width:100%;max-width:420px;height:100vh;max-height:750px;position:relative;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}
canvas{display:block;width:100%;height:100%}
</style>
</head>
<body>
<div id="gc"><canvas id="c"></canvas></div>
<script>
'use strict';
(()=>{
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d');
const container=document.getElementById('gc');

/* ── Hi-DPI ── */
const MAX_DPR=2;
let W,H,dpr;
function resize(){
  const r=container.getBoundingClientRect();
  dpr=Math.min(window.devicePixelRatio||1,MAX_DPR);
  W=r.width;H=r.height;
  canvas.width=W*dpr;canvas.height=H*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
window.addEventListener('resize',resize);

/* ── Constants ── */
const LANE_DIV=8;
const PLAYER_SZ=20;
const GATE_H=55;
const BASE_SPEED=3.0;
const SPEED_RAMP=0.013;
const PERFECT_BASE=0.18;
const PERFECT_MIN=0.07;
const LS_KEY='cd_best';

/* ── Color palette ── */
const PALETTE=[
  {h:4,s:82,l:58,n:'Red'},
  {h:145,s:65,l:48,n:'Green'},
  {h:215,s:78,l:58,n:'Blue'},
  {h:42,s:92,l:54,n:'Orange'},
  {h:275,s:68,l:60,n:'Purple'},
  {h:175,s:70,l:48,n:'Teal'},
];
const hsl=(c,a=1)=>`hsla(${c.h},${c.s}%,${c.l}%,${a})`;
const hslL=(c,dl,a=1)=>`hsla(${c.h},${c.s}%,${Math.max(0,Math.min(100,c.l+dl))}%,${a})`;

/* ── Seeded RNG (optional daily mode) ── */
const params=new URLSearchParams(location.search);
const daily=params.get('daily');
let seed=0;
if(daily){for(let i=0;i<daily.length;i++)seed=((seed<<5)-seed)+daily.charCodeAt(i)|0;}
function rng(){
  if(!daily)return Math.random();
  seed=(seed*1664525+1013904223)&0x7fffffff;
  return seed/0x7fffffff;
}

/* ── Game state ── */
let state='start';
let score=0,best=0,combo=0,maxCombo=0;
let timeScale=1,tsTimer=0;
let shakeAmt=0;
let bgHue=220;
let runTime=0,gameSpeed=BASE_SPEED,perfectW=PERFECT_BASE;
let playerLane=0; // 0=left,1=right
let pColors=[PALETTE[0],PALETTE[2]]; // [leftColor,rightColor]
let gates=[],particles=[],rings=[];
let nextGateT=0,gateNum=0;
let laneGlow=[0,0];

try{best=parseInt(localStorage.getItem(LS_KEY))||0;}catch(e){}
function saveBest(){try{localStorage.setItem(LS_KEY,String(best));}catch(e){}}

/* ── Helpers ── */
function lnX(l){const lw=(W-LANE_DIV)/2;return l===0?lw/2:W/2+LANE_DIV/2+lw/2;}
function lnL(l){return l===0?0:W/2+LANE_DIV/2;}
function lnW(){return(W-LANE_DIV)/2;}
const playerY=()=>H*0.78;

function pick2(){
  const a=Math.floor(rng()*PALETTE.length);
  let b=a;while(b===a)b=Math.floor(rng()*PALETTE.length);
  return[PALETTE[a],PALETTE[b]];
}
function pickExcept(ex){
  const f=PALETTE.filter(c=>c.h!==ex.h);
  return f[Math.floor(rng()*f.length)];
}

/* ── Gate spawning ── */
function spawnGate(){
  gateNum++;
  const diff=Math.min(runTime/60,1);
  const r=rng();
  let leftC,rightC;

  if(r<0.10+diff*0.04){
    // Breather: same color both, always safe
    const c=rng()<0.5?pColors[0]:pColors[1];
    leftC=c;rightC=c;
  } else if(r<0.22+diff*0.06){
    // Both match — player can stay in either lane
    leftC=pColors[0];rightC=pColors[1];
  } else {
    // One side matches, other doesn't — forces the player into the correct lane
    if(rng()<0.5){
      leftC=pColors[0];
      rightC=rng()<0.35+diff*0.15?pColors[1]:pickExcept(pColors[1]);
    } else {
      rightC=pColors[1];
      leftC=rng()<0.35+diff*0.15?pColors[0]:pickExcept(pColors[0]);
    }
  }

  gates.push({y:-GATE_H,leftC,rightC,passed:false,scored:false});
}

/* ── Particles ── */
function emit(x,y,col,n=10){
  for(let i=0;i<n;i++){
    const a=Math.random()*Math.PI*2;
    const sp=1+Math.random()*3.5;
    particles.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp-1.5,life:1,decay:0.014+Math.random()*0.022,sz:2+Math.random()*3.5,col});
  }
}
function emitRing(x,y,col){
  rings.push({x,y,r:8,mr:55,a:1,col});
}

/* ── Shake ── */
function shake(amt){shakeAmt=Math.max(shakeAmt,amt);}

/* ── Start / Restart ── */
function startGame(){
  state='playing';
  score=0;combo=0;maxCombo=0;
  runTime=0;gameSpeed=BASE_SPEED;perfectW=PERFECT_BASE;
  playerLane=0;
  gates=[];particles=[];rings=[];
  gateNum=0;nextGateT=0.7;
  timeScale=1;tsTimer=0;shakeAmt=0;
  laneGlow=[0,0];
  pColors=pick2();
}

function gameOver(){
  state='gameover';
  shake(14);
  if(score>best){best=score;saveBest();}
  const px=lnX(playerLane);
  emit(px,playerY(),pColors[playerLane],35);
}

/* ── Input ── */
function onInput(){
  if(state==='start'){startGame();return;}
  if(state==='gameover'){startGame();return;}
  playerLane=playerLane===0?1:0;
}
canvas.addEventListener('pointerdown',e=>{e.preventDefault();onInput();});
document.addEventListener('keydown',e=>{
  if(e.code==='Space'||e.code==='Enter'){e.preventDefault();onInput();}
});

/* ── Update ── */
function update(dt){
  if(state!=='playing')return;

  // TimeScale
  if(tsTimer>0){tsTimer-=dt;if(tsTimer<=0){timeScale=1;tsTimer=0;}}
  const adt=dt*timeScale;
  runTime+=adt;

  // Difficulty
  gameSpeed=BASE_SPEED+runTime*SPEED_RAMP;
  perfectW=Math.max(PERFECT_MIN,PERFECT_BASE-runTime*0.0004);

  // Spawn
  nextGateT-=adt;
  if(nextGateT<=0){
    spawnGate();
    nextGateT=Math.max(0.55,1.6-runTime*0.007);
  }

  // Move gates
  const spd=gameSpeed*adt*60;
  const py=playerY();
  for(let i=gates.length-1;i>=0;i--){
    const g=gates[i];
    g.y+=spd;

    if(!g.passed && g.y+GATE_H>py-PLAYER_SZ/2 && g.y<py+PLAYER_SZ/2){
      g.passed=true;
      const pc=pColors[playerLane];
      const gc=playerLane===0?g.leftC:g.rightC;
      if(pc.h!==gc.h){gameOver();return;}

      // Perfect check
      const mid=g.y+GATE_H/2;
      const dist=Math.abs(mid-py)/(GATE_H/2);
      if(dist<perfectW){
        combo++;
        if(combo>maxCombo)maxCombo=combo;
        score+=Math.min(combo,12);
        timeScale=0.25;tsTimer=0.09;
        emitRing(lnX(playerLane),py,pc);
        emit(lnX(playerLane),py,pc,18);
        shake(3);
        laneGlow[playerLane]=1;
      } else {
        score++;
        combo=0;
        emit(lnX(playerLane),py,pc,6);
      }
      g.scored=true;
    }
    if(g.y>H+GATE_H)gates.splice(i,1);
  }

  // Particles
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx*adt*60;p.y+=p.vy*adt*60;
    p.vy+=0.06*adt*60;
    p.life-=p.decay*adt*60;
    if(p.life<=0)particles.splice(i,1);
  }

  // Rings
  for(let i=rings.length-1;i>=0;i--){
    const rn=rings[i];
    rn.r+=(rn.mr-rn.r)*0.13*adt*60;
    rn.a-=0.035*adt*60;
    if(rn.a<=0)rings.splice(i,1);
  }

  // Lane glow decay
  laneGlow[0]=Math.max(0,laneGlow[0]-0.03*adt*60);
  laneGlow[1]=Math.max(0,laneGlow[1]-0.03*adt*60);

  // Shake decay
  if(shakeAmt>0){shakeAmt*=0.86;if(shakeAmt<0.3)shakeAmt=0;}

  bgHue=(bgHue+0.12*adt*60)%360;
}

/* ── Rounded rect ── */
function rrect(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);
  ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);
  ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r);
  ctx.quadraticCurveTo(x,y,x+r,y);
  ctx.closePath();
}

/* ── Draw ── */
function draw(){
  ctx.save();
  // Shake
  const sx=shakeAmt>0?(Math.random()-0.5)*shakeAmt:0;
  const sy=shakeAmt>0?(Math.random()-0.5)*shakeAmt:0;
  ctx.translate(sx,sy);

  // BG
  const grad=ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,`hsl(${bgHue|0},28%,7%)`);
  grad.addColorStop(1,`hsl(${(bgHue+40|0)%360},22%,11%)`);
  ctx.fillStyle=grad;
  ctx.fillRect(-20,-20,W+40,H+40);

  // Lane divider
  ctx.save();
  ctx.setLineDash([6,10]);
  ctx.strokeStyle='rgba(255,255,255,0.07)';
  ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(W/2,0);ctx.lineTo(W/2,H);ctx.stroke();
  ctx.setLineDash([]);
  ctx.restore();

  // Lane color tint
  if(state==='playing'||state==='gameover'){
    ctx.fillStyle=hsl(pColors[0],0.03);
    ctx.fillRect(0,0,W/2,H);
    ctx.fillStyle=hsl(pColors[1],0.03);
    ctx.fillRect(W/2,0,W/2,H);
  }

  // Lane glow
  for(let l=0;l<2;l++){
    if(laneGlow[l]>0){
      const g=ctx.createRadialGradient(lnX(l),playerY(),0,lnX(l),playerY(),90);
      g.addColorStop(0,hsl(pColors[l],laneGlow[l]*0.3));
      g.addColorStop(1,'transparent');
      ctx.fillStyle=g;
      ctx.fillRect(lnL(l),playerY()-110,lnW(),220);
    }
  }

  if(state==='playing'||state==='gameover'){
    drawGates();
    drawRings();
    if(state==='playing')drawPlayer();
    drawParticles();
    drawHUD();
  }
  if(state==='start')drawStart();
  if(state==='gameover')drawOver();

  ctx.restore();
}

function drawGates(){
  const lw=lnW();
  for(const g of gates){
    // Left gate
    ctx.fillStyle=hsl(g.leftC,0.85);
    rrect(lnL(0)+4,g.y,lw-8,GATE_H,6);ctx.fill();
    // Subtle inner lines
    ctx.strokeStyle=hslL(g.leftC,12,0.3);
    ctx.lineWidth=1;
    for(let ly=g.y+10;ly<g.y+GATE_H-6;ly+=9){
      ctx.beginPath();ctx.moveTo(lnL(0)+12,ly);ctx.lineTo(lnL(0)+lw-12,ly);ctx.stroke();
    }
    // Gate color letter
    ctx.fillStyle=hslL(g.leftC,25,0.7);
    ctx.font='bold 13px system-ui';ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText(g.leftC.n[0],lnX(0),g.y+GATE_H/2);

    // Right gate
    ctx.fillStyle=hsl(g.rightC,0.85);
    rrect(lnL(1)+4,g.y,lw-8,GATE_H,6);ctx.fill();
    ctx.strokeStyle=hslL(g.rightC,12,0.3);
    ctx.lineWidth=1;
    for(let ly=g.y+10;ly<g.y+GATE_H-6;ly+=9){
      ctx.beginPath();ctx.moveTo(lnL(1)+12,ly);ctx.lineTo(lnL(1)+lw-12,ly);ctx.stroke();
    }
    ctx.fillStyle=hslL(g.rightC,25,0.7);
    ctx.font='bold 13px system-ui';ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText(g.rightC.n[0],lnX(1),g.y+GATE_H/2);

    // Perfect center line
    if(!g.passed){
      const cy=g.y+GATE_H/2;
      ctx.strokeStyle='rgba(255,255,255,0.2)';
      ctx.lineWidth=1;
      ctx.beginPath();ctx.moveTo(lnL(0)+8,cy);ctx.lineTo(lnL(0)+lw-8,cy);ctx.stroke();
      ctx.beginPath();ctx.moveTo(lnL(1)+8,cy);ctx.lineTo(lnL(1)+lw-8,cy);ctx.stroke();
    }
  }
}

function drawPlayer(){
  const px=lnX(playerLane),py=playerY();
  const c=pColors[playerLane];

  // Glow
  const grd=ctx.createRadialGradient(px,py,0,px,py,PLAYER_SZ*2);
  grd.addColorStop(0,hsl(c,0.35));grd.addColorStop(1,'transparent');
  ctx.fillStyle=grd;ctx.fillRect(px-45,py-45,90,90);

  // Diamond body
  ctx.fillStyle=hsl(c);
  ctx.save();ctx.translate(px,py);ctx.rotate(Math.PI/4);
  rrect(-PLAYER_SZ/2,-PLAYER_SZ/2,PLAYER_SZ,PLAYER_SZ,4);ctx.fill();
  ctx.restore();

  // Inner diamond
  ctx.fillStyle=hslL(c,18,0.55);
  ctx.save();ctx.translate(px,py);ctx.rotate(Math.PI/4);
  rrect(-PLAYER_SZ/4,-PLAYER_SZ/4,PLAYER_SZ/2,PLAYER_SZ/2,2);ctx.fill();
  ctx.restore();

  // Color dots showing both lane colors
  ctx.fillStyle=hsl(pColors[0],0.75);
  ctx.beginPath();ctx.arc(px-13,py+20,4,0,Math.PI*2);ctx.fill();
  ctx.fillStyle=hsl(pColors[1],0.75);
  ctx.beginPath();ctx.arc(px+13,py+20,4,0,Math.PI*2);ctx.fill();

  // Active dot underline
  const ux=playerLane===0?px-13:px+13;
  ctx.fillStyle='rgba(255,255,255,0.85)';
  ctx.fillRect(ux-5,py+26,10,2);
}

function drawRings(){
  for(const r of rings){
    ctx.strokeStyle=hsl(r.col,r.a);ctx.lineWidth=2.5;
    ctx.beginPath();ctx.arc(r.x,r.y,r.r,0,Math.PI*2);ctx.stroke();
  }
}

function drawParticles(){
  for(const p of particles){
    ctx.globalAlpha=Math.max(0,p.life);
    ctx.fillStyle=hsl(p.col);
    ctx.beginPath();ctx.arc(p.x,p.y,p.sz*p.life,0,Math.PI*2);ctx.fill();
  }
  ctx.globalAlpha=1;
}

function drawHUD(){
  ctx.textAlign='center';ctx.textBaseline='top';
  ctx.font='bold 30px system-ui';ctx.fillStyle='rgba(255,255,255,0.92)';
  ctx.fillText(score,W/2,18);

  if(combo>1){
    ctx.font='bold 15px system-ui';
    ctx.fillStyle=`hsla(${50+combo*18},92%,65%,0.92)`;
    ctx.fillText(`x${combo}`,W/2,52);
  }

  // Lane color labels
  ctx.font='bold 10px system-ui';ctx.textBaseline='top';
  ctx.fillStyle=hsl(pColors[0],0.45);ctx.textAlign='center';
  ctx.fillText(pColors[0].n,lnX(0),6);
  ctx.fillStyle=hsl(pColors[1],0.45);
  ctx.fillText(pColors[1].n,lnX(1),6);
}

function drawStart(){
  ctx.fillStyle='rgba(0,0,0,0.5)';ctx.fillRect(0,0,W,H);
  ctx.textAlign='center';ctx.textBaseline='middle';

  const ty=H*0.28;
  ctx.font='bold 40px system-ui';
  ctx.fillStyle=`hsla(${(bgHue+60)%360},80%,70%,0.92)`;
  ctx.fillText('COLOR',W/2,ty-22);
  ctx.fillStyle=`hsla(${(bgHue+130)%360},80%,70%,0.92)`;
  ctx.fillText('DASH',W/2,ty+24);

  ctx.font='13px system-ui';ctx.fillStyle='rgba(255,255,255,0.45)';
  ctx.fillText('Split Decision',W/2,ty+54);

  const iy=H*0.5;
  ctx.font='14px system-ui';ctx.fillStyle='rgba(255,255,255,0.7)';
  ctx.fillText('Tap or Space to swap lanes',W/2,iy);
  ctx.fillText('Match your color to the gate',W/2,iy+22);
  ctx.fillText('Hit the center for Perfect combos!',W/2,iy+44);

  if(best>0){
    ctx.font='bold 13px system-ui';ctx.fillStyle='rgba(255,255,200,0.55)';
    ctx.fillText(`Best: ${best}`,W/2,iy+80);
  }

  const pulse=0.45+Math.sin(Date.now()*0.004)*0.5;
  ctx.font='bold 18px system-ui';ctx.fillStyle=`rgba(255,255,255,${0.35+pulse*0.55})`;
  ctx.fillText('TAP TO START',W/2,H*0.8);

  // Animated diamonds
  const now=Date.now()*0.001;
  const prev=[PALETTE[0],PALETTE[2],PALETTE[1],PALETTE[4]];
  for(let i=0;i<4;i++){
    const ang=now*0.7+i*Math.PI/2;
    const rx=Math.cos(ang)*28,ry=Math.sin(ang)*14;
    ctx.fillStyle=hsl(prev[i],0.55);
    ctx.save();ctx.translate(W/2+rx,H*0.4+ry);ctx.rotate(Math.PI/4+ang*0.4);
    ctx.fillRect(-5,-5,10,10);ctx.restore();
  }
}

function drawOver(){
  ctx.fillStyle='rgba(0,0,0,0.6)';ctx.fillRect(0,0,W,H);
  ctx.textAlign='center';ctx.textBaseline='middle';

  const cy=H*0.35;
  ctx.font='bold 34px system-ui';ctx.fillStyle='rgba(255,75,75,0.92)';
  ctx.fillText('CRASH!',W/2,cy);

  ctx.font='bold 50px system-ui';ctx.fillStyle='rgba(255,255,255,0.95)';
  ctx.fillText(score,W/2,cy+56);

  ctx.font='13px system-ui';ctx.fillStyle='rgba(255,255,255,0.45)';
  ctx.fillText('SCORE',W/2,cy+86);

  if(maxCombo>1){
    ctx.font='bold 16px system-ui';ctx.fillStyle='rgba(255,200,70,0.8)';
    ctx.fillText(`Best Combo: x${maxCombo}`,W/2,cy+115);
  }

  ctx.font='bold 14px system-ui';ctx.fillStyle='rgba(255,255,200,0.65)';
  ctx.fillText(`Best: ${best}`,W/2,cy+142);

  if(score>=best&&score>0){
    ctx.font='bold 13px system-ui';ctx.fillStyle='rgba(255,215,0,0.9)';
    ctx.fillText('NEW BEST!',W/2,cy+168);
  }

  const pulse=0.45+Math.sin(Date.now()*0.004)*0.5;
  ctx.font='bold 16px system-ui';ctx.fillStyle=`rgba(255,255,255,${0.35+pulse*0.45})`;
  ctx.fillText('TAP TO RETRY',W/2,H*0.78);
}

/* ── Loop ── */
let lastT=performance.now();
function loop(now){
  const raw=Math.min((now-lastT)/1000,0.05);
  lastT=now;
  update(raw);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
})();
</script>
</body>
</html>
