<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Color Dash - Free HTML5 Game</title>
<meta name="description" content="Play Color Dash - Run through color gates matching your current color. Tap to switch between colors. Speed increases every 10 points.">
<meta name="theme-color" content="#0b1020">
<link rel="canonical" href="https://balinti.github.io/color-dash/">
<meta property="og:type" content="website">
<meta property="og:title" content="Color Dash - Free HTML5 Game">
<meta property="og:description" content="Play Color Dash - Run through color gates matching your current color. Tap to switch between colors. Speed increases every 10 points.">
<meta property="og:url" content="https://balinti.github.io/color-dash/">
<meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'%3E%3Crect fill='%230b1020' width='1200' height='630'/%3E%3Ctext x='600' y='280' text-anchor='middle' font-family='sans-serif' font-size='80' font-weight='bold' fill='%2300e5ff'%3EColor Dash%3C/text%3E%3Ctext x='600' y='360' text-anchor='middle' font-family='sans-serif' font-size='36' fill='%23ff6ec7'%3ESlipstream Split%3C/text%3E%3Ccircle cx='400' cy='480' r='30' fill='%23ff3c5f'/%3E%3Ccircle cx='600' cy='480' r='30' fill='%2300e5ff'/%3E%3Ccircle cx='800' cy='480' r='30' fill='%23ffe03c'/%3E%3C/svg%3E">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Color Dash - Free HTML5 Game">
<meta name="twitter:description" content="Play Color Dash - Run through color gates matching your current color. Tap to switch between colors. Speed increases every 10 points.">
<meta name="twitter:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'%3E%3Crect fill='%230b1020' width='1200' height='630'/%3E%3Ctext x='600' y='280' text-anchor='middle' font-family='sans-serif' font-size='80' font-weight='bold' fill='%2300e5ff'%3EColor Dash%3C/text%3E%3Ctext x='600' y='360' text-anchor='middle' font-family='sans-serif' font-size='36' fill='%23ff6ec7'%3ESlipstream Split%3C/text%3E%3C/svg%3E">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow-x:hidden;background:#0b1020;font-family:'Segoe UI',system-ui,sans-serif;color:#fff;touch-action:none;user-select:none;-webkit-user-select:none}
#wrap{display:flex;flex-direction:column;align-items:center;width:100%;min-height:100vh;min-height:100dvh}
#gameContainer{position:relative;width:100%;max-width:420px;flex:1 1 auto;max-height:750px}
canvas{display:block;width:100%;height:100%;border-radius:12px}
#about{max-width:420px;width:100%;padding:6px 12px 18px}
#aboutToggle{background:none;border:1px solid rgba(255,255,255,.15);color:rgba(255,255,255,.5);font-size:12px;padding:5px 14px;border-radius:6px;cursor:pointer;width:100%;text-align:left;font-family:inherit}
#aboutToggle:hover{border-color:rgba(255,255,255,.3);color:rgba(255,255,255,.7)}
#aboutContent{display:none;padding:8px 0;font-size:12px;line-height:1.5;color:rgba(255,255,255,.55)}
#aboutContent.open{display:block}
#aboutContent h3{font-size:13px;margin:8px 0 2px;color:rgba(255,255,255,.72)}
#aboutContent p{margin:2px 0 4px}
</style>
</head>
<body>
<div id="wrap">
<div id="gameContainer"><canvas id="c"></canvas></div>
<div id="about">
<button id="aboutToggle" aria-expanded="false">&#9656; About / How to Play</button>
<div id="aboutContent" role="region">
<h3>Color Dash &mdash; Slipstream Split</h3>
<p>Tap or press Space to hop one lane to the right (wraps around). Match your color &amp; lane to the gate opening to pass through safely.</p>
<p>Each color has a unique pattern (stripes / dots / chevrons) so you can tell them apart even without relying on color alone.</p>
<p>Score +1 per gate, +1 bonus for a Perfect center pass. Chain Perfects for up to &times;4 multiplier!</p>
<h3>Gate Types</h3>
<p><strong>Split</strong> &mdash; standard openings. <strong>Shift</strong> &mdash; openings drift sideways (ghost trail shows movement). <strong>Fake-out</strong> &mdash; one lane closes late (flashing outline warns you). <strong>Double</strong> &mdash; two gates back-to-back.</p>
<h3>Challenge Mode</h3>
<p>After a game, share a challenge link so friends face the exact same gate sequence and try to beat your score!</p>
</div>
</div>
</div>
<script>
'use strict';
(()=>{

// ─── URL params / Seeded RNG ───
const _params=new URLSearchParams(location.search);
const challengeSeed=_params.get('challengeSeed');
const scoreToBeat=_params.get('scoreToBeat')?parseInt(_params.get('scoreToBeat'),10):null;
let rngState=challengeSeed?parseInt(challengeSeed,10):(Date.now()^(Math.random()*0xffffffff>>>0));
const sessionSeed=rngState;
function srand(){rngState=(rngState*1664525+1013904223)>>>0;return rngState/0xffffffff}

// ─── Canvas ───
const cvs=document.getElementById('c');
const ctx=cvs.getContext('2d');
const box=document.getElementById('gameContainer');
let W,H,dpr;
function resize(){
  const r=box.getBoundingClientRect();
  dpr=Math.min(devicePixelRatio||1,2);
  W=r.width; H=r.height;
  cvs.width=W*dpr; cvs.height=H*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
window.addEventListener('resize',resize);

// ─── Colors + colorblind patterns ───
const COLORS=[
  {hex:'#ff3c5f',h:350,pat:'stripes'},
  {hex:'#00e5ff',h:187,pat:'dots'},
  {hex:'#ffe03c',h:52, pat:'chevrons'}
];

function drawPat(x,y,r,ci,a){
  const c=COLORS[ci]; ctx.save(); ctx.globalAlpha=a||1; ctx.translate(x,y);
  if(c.pat==='stripes'){
    ctx.strokeStyle='rgba(0,0,0,.35)';ctx.lineWidth=Math.max(2,r*.18);
    for(let i=-2;i<=2;i++){const o=i*r*.35;ctx.beginPath();ctx.moveTo(o,-r);ctx.lineTo(o,r);ctx.stroke();}
  }else if(c.pat==='dots'){
    ctx.fillStyle='rgba(0,0,0,.3)';const d=Math.max(1.5,r*.13);
    [[-0.3,-0.3],[.3,-.3],[0,0],[-.3,.3],[.3,.3]].forEach(([px,py])=>{ctx.beginPath();ctx.arc(px*r,py*r,d,0,Math.PI*2);ctx.fill();});
  }else{
    ctx.strokeStyle='rgba(0,0,0,.35)';ctx.lineWidth=Math.max(2,r*.16);ctx.lineCap='round';
    for(let i=-1;i<=1;i++){const o=i*r*.45;ctx.beginPath();ctx.moveTo(-r*.35,o-r*.15);ctx.lineTo(0,o+r*.15);ctx.lineTo(r*.35,o-r*.15);ctx.stroke();}
  }
  ctx.restore();
}

// ─── Constants ───
const LANES=3;
const PLAYER_Y_RATIO=0.82;

// ─── State ───
let state='start';
let score,best=parseInt(localStorage.getItem('cdss_best2'))||0;
let pLane,pCI; // player lane, color index
let gates,particles;
let shakeX,shakeY,shakeDur,shakeInt;
let hitStop;
let streak,mult,maxMult,perfects;
let gTime,gTimer;
let deathFlash,deathVig;
let goDebounce;
let hueT;
let prevT=0;

function resetState(){
  score=0;pLane=1;pCI=0;
  gates=[];particles=[];
  shakeX=shakeY=shakeDur=shakeInt=0;
  hitStop=0;streak=0;mult=1;maxMult=1;perfects=0;
  gTime=0;gTimer=0.8;
  deathFlash=0;deathVig=0;goDebounce=0;hueT=0;
  rngState=challengeSeed?parseInt(challengeSeed,10):(Date.now()^(Math.random()*0xffffffff>>>0));
}

// ─── Difficulty curves (continuous) ───
function gateSpeed(){return 140+score*2.5+gTime*4}
function gateInterval(){return Math.max(0.50,1.55-score*0.013-gTime*0.009)}
function perfectRatio(){return Math.max(0.12,0.36-score*0.003)}
function openW(){const lw=W/LANES;return Math.max(lw*0.44,lw*0.84-score*0.75)}

// ─── Gate creation ───
function pickType(){
  const r=srand(),s=Math.min(score,60)/60;
  if(r<.38-s*.2)return'split';if(r<.62-s*.05)return'shift';if(r<.84)return'fakeout';return'double';
}
function mkGate(yOff){
  const lw=W/LANES,ow=openW();
  const lanes=[];
  for(let i=0;i<LANES;i++) lanes.push({ci:Math.floor(srand()*COLORS.length),open:true,cx:lw*i+lw/2,ow});
  return{y:-H*0.07-(yOff||0),type:'split',lanes,passed:false,scored:false,h:H*0.065,
    shDir:srand()>.5?1:-1,shSpd:22+srand()*35,shAcc:0,
    foLane:Math.floor(srand()*LANES),foTriggered:false,foTimer:0,ghost:[]};
}
function spawnGates(){
  const t=pickType();
  if(t==='double'){const a=mkGate(0);a.type='split';gates.push(a);const b=mkGate(H*.16);b.type='split';gates.push(b);}
  else{const g=mkGate(0);g.type=t;gates.push(g);}
}

// ─── Particles ───
function emit(x,y,n,hue,big){
  for(let i=0;i<n;i++){
    const a=Math.random()*Math.PI*2,sp=(big?130:65)+Math.random()*(big?190:95);
    particles.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,
      life:.4+Math.random()*.4,ml:.4+Math.random()*.4,
      sz:(big?4:2)+Math.random()*(big?5:3),hue:hue+Math.random()*40-20,ring:false});
  }
}
function emitRing(x,y,hue){particles.push({x,y,vx:0,vy:0,life:.5,ml:.5,sz:0,hue,ring:true,rr:6});}

// ─── Input ───
function tap(){
  if(state==='start'){state='playing';resetState();return;}
  if(state==='gameover'){if(goDebounce<=0){state='playing';resetState();}return;}
  hop();
}
function hop(){
  const next=(pLane+1)%LANES;
  // Smart-swap: check nearest upcoming gate
  let swapColor=false;
  const py=H*PLAYER_Y_RATIO,look=H*.38;
  for(const g of gates){
    if(g.passed||g.scored)continue;
    const gy=g.y+g.h/2;
    if(gy>py-look&&gy<py+g.h){
      const ln=g.lanes[next];
      if(ln&&ln.open&&ln.ci!==pCI) swapColor=true;
      break;
    }
  }
  pLane=next;
  if(swapColor) pCI=(pCI+1)%COLORS.length;
}

cvs.addEventListener('pointerdown',e=>{e.preventDefault();tapHandler(e);});
document.addEventListener('keydown',e=>{if(e.code==='Space'||e.code==='Enter'){e.preventDefault();tap();}});

function tapHandler(e){
  // Check gameover buttons first
  if(state==='gameover'){
    const rect=cvs.getBoundingClientRect();
    const sx=(e.clientX-rect.left)/rect.width*W;
    const sy=(e.clientY-rect.top)/rect.height*H;
    for(const b of _btns){
      if(sx>=b.x&&sx<=b.x+b.w&&sy>=b.y&&sy<=b.y+b.h){b.fn();return;}
    }
  }
  tap();
}

// ─── Helpers ───
function laneX(l){return W/LANES*l+W/LANES/2}

function die(){
  state='gameover';goDebounce=.35;
  if(score>best){best=score;localStorage.setItem('cdss_best2',best);}
  shakeDur=.5;shakeInt=14;deathFlash=.3;deathVig=1;
  emit(laneX(pLane),H*PLAYER_Y_RATIO,45,COLORS[pCI].h,true);
}

// ─── Update ───
function update(dt){
  if(hitStop>0){hitStop-=dt;return;}
  hueT+=dt*22;

  if(state==='gameover'){
    if(goDebounce>0)goDebounce-=dt;
    deathFlash=Math.max(0,deathFlash-dt*2.5);
    deathVig=Math.max(0,deathVig-dt*.8);
  }

  // Shake decay
  if(shakeDur>0){
    shakeDur-=dt;
    const t=Math.max(0,shakeDur);
    shakeX=(Math.random()-.5)*shakeInt*t*7;
    shakeY=(Math.random()-.5)*shakeInt*t*7;
  }else{shakeX=shakeY=0;}

  // Particles
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];p.life-=dt;
    if(p.life<=0){particles.splice(i,1);continue;}
    if(p.ring){p.rr+=dt*220;continue;}
    p.x+=p.vx*dt;p.y+=p.vy*dt;p.vy+=320*dt;p.vx*=.97;
  }

  if(state!=='playing')return;
  gTime+=dt;

  // Spawn
  gTimer-=dt;
  if(gTimer<=0){spawnGates();gTimer=gateInterval();}

  const spd=gateSpeed(),py=H*PLAYER_Y_RATIO,pr=W*.045,px=laneX(pLane);
  const lw=W/LANES;

  for(let i=gates.length-1;i>=0;i--){
    const g=gates[i];
    g.y+=spd*dt;

    // Shift drift
    if(g.type==='shift'){
      g.shAcc+=g.shDir*g.shSpd*dt;
      for(let l=0;l<g.lanes.length;l++) g.lanes[l].cx=lw*l+lw/2+g.shAcc;
      if(!g.ghost.length||Math.abs(g.shAcc-g.ghost[g.ghost.length-1])>3){
        g.ghost.push(g.shAcc);if(g.ghost.length>10)g.ghost.shift();
      }
    }

    // Fakeout closure
    if(g.type==='fakeout'&&!g.foTriggered){
      if(g.y+g.h/2-py>-H*.18&&g.y+g.h/2-py<H*.06){g.foTriggered=true;g.foTimer=.22;}
    }
    if(g.type==='fakeout'&&g.foTriggered&&g.foTimer>0){
      g.foTimer-=dt;if(g.foTimer<=0) g.lanes[g.foLane].open=false;
    }

    // Off-screen removal
    if(g.y>H+60){gates.splice(i,1);continue;}

    // Collision
    if(!g.passed){
      const gT=g.y,gB=g.y+g.h,pT=py-pr,pB=py+pr;
      if(pB>gT&&pT<gB){
        const ln=g.lanes[pLane];
        if(!ln){die();return;}
        const hf=ln.ow/2;
        const inOpen=Math.abs(px-ln.cx)<hf;
        if(!inOpen||ln.ci!==pCI||!ln.open){die();return;}
        if(!g.scored){
          g.scored=true;
          const pw=hf*perfectRatio();
          const perf=Math.abs(px-ln.cx)<pw;
          let pts=1;
          if(perf){
            pts+=1;perfects++;streak++;
            mult=Math.min(4,1+Math.floor(streak/2));
            if(mult>maxMult)maxMult=mult;
            hitStop=.04;shakeDur=.1;shakeInt=3;
            emitRing(px,py,COLORS[pCI].h);
            emit(px,py,22,COLORS[pCI].h,true);
          }else{
            streak=0;mult=1;
            emit(px,py,9,COLORS[pCI].h,false);
          }
          score+=pts*mult;
          // Near miss extra particles
          if(!perf&&Math.abs(px-ln.cx)>hf*.55){emit(px,py,14,55,false);}
        }
      }
      if(g.y>py+pr) g.passed=true;
    }
  }
}

// ─── Draw ───
let _btns=[];

function draw(){
  _btns=[];
  ctx.save();
  ctx.translate(shakeX,shakeY);

  // BG
  const bg=ctx.createLinearGradient(0,0,0,H);
  bg.addColorStop(0,'#0b1020');bg.addColorStop(1,'#151035');
  ctx.fillStyle=bg;ctx.fillRect(-20,-20,W+40,H+40);

  // Lane dividers
  ctx.strokeStyle='rgba(255,255,255,.06)';ctx.lineWidth=1;ctx.setLineDash([8,14]);
  const lw=W/LANES;
  for(let i=1;i<LANES;i++){ctx.beginPath();ctx.moveTo(lw*i,0);ctx.lineTo(lw*i,H);ctx.stroke();}
  ctx.setLineDash([]);

  // Gates
  for(const g of gates) drawGate(g);

  // Player (visible in start & playing)
  if(state!=='gameover') drawPlayer();

  // Particles
  for(const p of particles){
    const a=p.life/p.ml;
    if(p.ring){
      ctx.strokeStyle=`hsla(${p.hue},100%,65%,${a*.55})`;ctx.lineWidth=2.5;
      ctx.beginPath();ctx.arc(p.x,p.y,p.rr,0,Math.PI*2);ctx.stroke();
    }else{
      ctx.fillStyle=`hsla(${p.hue},100%,65%,${a})`;
      ctx.beginPath();ctx.arc(p.x,p.y,p.sz*a,0,Math.PI*2);ctx.fill();
    }
  }

  // Death FX
  if(deathFlash>0){ctx.fillStyle=`rgba(255,255,255,${deathFlash})`;ctx.fillRect(-20,-20,W+40,H+40);}
  if(deathVig>0){
    const vg=ctx.createRadialGradient(W/2,H/2,H*.15,W/2,H/2,H*.72);
    vg.addColorStop(0,'rgba(0,0,0,0)');vg.addColorStop(1,`rgba(0,0,0,${deathVig*.65})`);
    ctx.fillStyle=vg;ctx.fillRect(-20,-20,W+40,H+40);
  }

  drawUI();
  ctx.restore();
}

function drawGate(g){
  const lw=W/LANES;
  for(let l=0;l<g.lanes.length;l++){
    const ln=g.lanes[l];
    const col=COLORS[ln.ci];
    const cx=ln.cx,hf=ln.ow/2;
    const ll=lw*l,lr=lw*(l+1);

    if(!ln.open){
      ctx.fillStyle='rgba(255,50,50,.3)';ctx.fillRect(ll,g.y,lw,g.h);
      // X pattern for closed
      ctx.strokeStyle='rgba(255,80,80,.5)';ctx.lineWidth=2;
      ctx.beginPath();ctx.moveTo(ll+6,g.y+4);ctx.lineTo(lr-6,g.y+g.h-4);ctx.moveTo(lr-6,g.y+4);ctx.lineTo(ll+6,g.y+g.h-4);ctx.stroke();
      continue;
    }

    // Walls
    ctx.fillStyle='rgba(255,255,255,.07)';
    if(cx-hf>ll) ctx.fillRect(ll,g.y,cx-hf-ll,g.h);
    if(cx+hf<lr) ctx.fillRect(cx+hf,g.y,lr-(cx+hf),g.h);

    // Opening color band
    const oL=Math.max(ll,cx-hf),oR=Math.min(lr,cx+hf);
    if(oR>oL){
      ctx.fillStyle=col.hex+'44';ctx.fillRect(oL,g.y,oR-oL,g.h);
      // Side borders
      ctx.strokeStyle=col.hex;ctx.lineWidth=2;
      ctx.beginPath();ctx.moveTo(oL,g.y);ctx.lineTo(oL,g.y+g.h);ctx.moveTo(oR,g.y);ctx.lineTo(oR,g.y+g.h);ctx.stroke();
      // Pattern
      ctx.save();ctx.beginPath();ctx.rect(oL,g.y,oR-oL,g.h);ctx.clip();
      drawPat((oL+oR)/2,g.y+g.h/2,Math.min(oR-oL,g.h)*.4,ln.ci,.45);
      ctx.restore();
    }

    // Fakeout telegraph
    if(g.type==='fakeout'&&l===g.foLane&&!g.foTriggered){
      const fl=Math.sin(performance.now()*.013)*.5+.5;
      ctx.strokeStyle=`rgba(255,70,70,${fl*.65})`;ctx.lineWidth=2;ctx.setLineDash([4,4]);
      ctx.strokeRect(ll+1,g.y+1,lw-2,g.h-2);ctx.setLineDash([]);
    }
  }

  // Shift ghost trail
  if(g.type==='shift'&&g.ghost.length>1){
    const lw2=W/LANES;
    for(let t=0;t<g.ghost.length-1;t++){
      const al=.04+t/g.ghost.length*.12;
      ctx.strokeStyle=`rgba(255,255,255,${al})`;ctx.lineWidth=1;
      for(let l=0;l<g.lanes.length;l++){
        const tcx=lw2*l+lw2/2+g.ghost[t],hf=g.lanes[l].ow/2;
        ctx.beginPath();ctx.moveTo(tcx-hf,g.y);ctx.lineTo(tcx-hf,g.y+g.h);
        ctx.moveTo(tcx+hf,g.y);ctx.lineTo(tcx+hf,g.y+g.h);ctx.stroke();
      }
    }
  }
}

function drawPlayer(){
  const x=laneX(pLane||1),y=H*PLAYER_Y_RATIO,r=W*.045;
  const ci=pCI||0,col=COLORS[ci];
  // Glow
  const gl=ctx.createRadialGradient(x,y,r*.4,x,y,r*2.8);
  gl.addColorStop(0,col.hex+'44');gl.addColorStop(1,col.hex+'00');
  ctx.fillStyle=gl;ctx.beginPath();ctx.arc(x,y,r*2.8,0,Math.PI*2);ctx.fill();
  // Ball
  ctx.fillStyle=col.hex;ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fill();
  // Pattern
  ctx.save();ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.clip();
  drawPat(x,y,r,ci,.55);ctx.restore();
  // Highlight
  ctx.fillStyle='rgba(255,255,255,.22)';
  ctx.beginPath();ctx.arc(x-r*.25,y-r*.25,r*.32,0,Math.PI*2);ctx.fill();
}

function drawUI(){
  if(state==='start') drawStart();
  else if(state==='playing') drawHUD();
  else drawGO();
}

function drawStart(){
  ctx.fillStyle='rgba(11,16,32,.55)';ctx.fillRect(0,0,W,H);
  const cx=W/2;
  ctx.textAlign='center';ctx.textBaseline='middle';

  // Title
  ctx.font=`bold ${W*.115|0}px 'Segoe UI',system-ui,sans-serif`;
  // Title glow
  ctx.shadowColor='#00e5ff';ctx.shadowBlur=18;
  ctx.fillStyle='#00e5ff';ctx.fillText('Color Dash',cx,H*.24);
  ctx.shadowBlur=0;

  // Subtitle
  ctx.font=`${W*.05|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle='#ff6ec7';ctx.fillText('Slipstream Split',cx,H*.315);

  // How-to
  ctx.font=`${W*.034|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle='rgba(255,255,255,.55)';
  ctx.fillText('Tap / Space \u2192 hop lane right',cx,H*.42);
  ctx.fillText('Match color + lane to pass gates',cx,H*.46);

  // Challenge banner
  if(scoreToBeat!==null){
    ctx.font=`bold ${W*.042|0}px 'Segoe UI',system-ui,sans-serif`;
    ctx.fillStyle='#ffe03c';ctx.fillText(`Challenge: beat ${scoreToBeat}!`,cx,H*.54);
  }

  // CTA pulse
  const p=Math.sin(performance.now()*.004)*.3+.7;
  ctx.font=`bold ${W*.058|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle=`rgba(255,255,255,${p})`;ctx.fillText('Tap to Start',cx,H*.65);

  if(best>0){
    ctx.font=`${W*.036|0}px 'Segoe UI',system-ui,sans-serif`;
    ctx.fillStyle='rgba(255,255,255,.35)';ctx.fillText(`Best: ${best}`,cx,H*.72);
  }
}

function drawHUD(){
  // Score
  ctx.textAlign='left';ctx.textBaseline='top';
  ctx.font=`bold ${W*.082|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle='#fff';ctx.fillText(score,14,10);
  // Best
  ctx.font=`${W*.034|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle='rgba(255,255,255,.35)';ctx.fillText(`Best: ${best}`,14,10+W*.09);
  // Multiplier
  if(mult>1){
    ctx.textAlign='right';
    ctx.font=`bold ${W*.062|0}px 'Segoe UI',system-ui,sans-serif`;
    const mh=(hueT*6)%360;
    ctx.fillStyle=`hsl(${mh},100%,65%)`;ctx.fillText(`\u00d7${mult}`,W-14,10);
  }
  // Target
  if(scoreToBeat!==null){
    ctx.textAlign='right';ctx.font=`${W*.03|0}px 'Segoe UI',system-ui,sans-serif`;
    ctx.fillStyle=score>=scoreToBeat?'#0f8':'rgba(255,255,255,.3)';
    ctx.fillText(`Target: ${scoreToBeat}`,W-14,10+W*.072);
  }
  // Color indicator bar
  ctx.fillStyle=COLORS[pCI].hex+'77';ctx.fillRect(0,H-3,W,3);
}

function drawGO(){
  ctx.fillStyle='rgba(11,16,32,.72)';ctx.fillRect(0,0,W,H);
  const cx=W/2;
  ctx.textAlign='center';ctx.textBaseline='middle';

  ctx.font=`bold ${W*.092|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle='#ff3c5f';ctx.fillText('Game Over',cx,H*.2);

  ctx.font=`bold ${W*.14|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle='#fff';ctx.fillText(score,cx,H*.31);

  ctx.font=`${W*.04|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle='rgba(255,255,255,.5)';ctx.fillText(`Best: ${best}`,cx,H*.39);

  ctx.font=`${W*.033|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle='rgba(255,255,255,.4)';
  ctx.fillText(`Perfects: ${perfects}  \u2502  Max Mult: \u00d7${maxMult}`,cx,H*.445);

  if(scoreToBeat!==null){
    ctx.font=`bold ${W*.04|0}px 'Segoe UI',system-ui,sans-serif`;
    ctx.fillStyle=score>=scoreToBeat?'#0f8':'#ff6ec7';
    ctx.fillText(score>=scoreToBeat?'Challenge beaten!':'Challenge failed',cx,H*.51);
  }

  // Retry
  const rp=Math.sin(performance.now()*.004)*.3+.7;
  ctx.font=`bold ${W*.052|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.fillStyle=`rgba(255,255,255,${goDebounce>0?.18:rp})`;
  ctx.fillText('Tap to Retry',cx,H*.60);

  // Buttons
  drawBtn('Challenge a Friend',cx,H*.70,W*.58,W*.1,shareChallenge);
  drawBtn('Share',cx,H*.79,W*.36,W*.1,shareResult);
}

function drawBtn(txt,x,y,w,h,fn){
  const bx=x-w/2,by=y-h/2;
  ctx.fillStyle='rgba(255,255,255,.07)';ctx.strokeStyle='rgba(255,255,255,.22)';ctx.lineWidth=1;
  rr(ctx,bx,by,w,h,6);ctx.fill();ctx.stroke();
  ctx.fillStyle='rgba(255,255,255,.78)';
  ctx.font=`${W*.036|0}px 'Segoe UI',system-ui,sans-serif`;
  ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(txt,x,y);
  _btns.push({x:bx,y:by,w,h,fn});
}

function rr(c,x,y,w,h,r){
  c.beginPath();c.moveTo(x+r,y);c.lineTo(x+w-r,y);c.quadraticCurveTo(x+w,y,x+w,y+r);
  c.lineTo(x+w,y+h-r);c.quadraticCurveTo(x+w,y+h,x+w-r,y+h);c.lineTo(x+r,y+h);
  c.quadraticCurveTo(x,y+h,x,y+h-r);c.lineTo(x,y+r);c.quadraticCurveTo(x,y,x+r,y);c.closePath();
}

// ─── Share ───
function shareChallenge(){
  const sd=challengeSeed||sessionSeed;
  const u=`${location.origin}${location.pathname}?challengeSeed=${sd}&scoreToBeat=${score}`;
  doShare(`Can you beat my ${score} in Color Dash?`,u);
}
function shareResult(){
  doShare(`I scored ${score} in Color Dash!`,location.origin+location.pathname);
}
function doShare(t,u){
  if(navigator.share){navigator.share({title:'Color Dash',text:t,url:u}).catch(()=>{});}
  else if(navigator.clipboard){navigator.clipboard.writeText(t+' '+u).catch(()=>{});}
}

// ─── Loop ───
function loop(ts){
  requestAnimationFrame(loop);
  if(!prevT)prevT=ts;
  let dt=(ts-prevT)/1000;prevT=ts;
  if(dt>.1)dt=.1;
  update(dt);draw();
}
requestAnimationFrame(loop);

// ─── About toggle ───
const atBtn=document.getElementById('aboutToggle');
atBtn.addEventListener('click',()=>{
  const c=document.getElementById('aboutContent'),o=c.classList.toggle('open');
  atBtn.innerHTML=o?'&#9662; About / How to Play':'&#9656; About / How to Play';
  atBtn.setAttribute('aria-expanded',o);
});

})();
</script>
</body>
</html>
