<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Color Dash - Free HTML5 Game</title>
<meta name="description" content="Play Color Dash - Run through color gates matching your current color. Tap to switch between colors. Speed increases every 10 points.">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0b1020">
<meta property="og:type" content="website">
<meta property="og:title" content="Color Dash - Free HTML5 Game">
<meta property="og:description" content="Tap to flip between Sun and Moon modes. Match gates, grab bonuses, build multiplier combos. How far can you glide?">
<meta property="og:url" content="https://Balinti.github.io/color-dash/">
<meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='315' viewBox='0 0 600 315'%3E%3Crect fill='%230b1020' width='600' height='315'/%3E%3Ctext x='300' y='130' text-anchor='middle' font-size='64' fill='%23f4c542'%3E%E2%98%80%3C/text%3E%3Ctext x='300' y='210' text-anchor='middle' font-size='64' fill='%2388ccff'%3E%E2%98%BD%3C/text%3E%3Ctext x='300' y='285' text-anchor='middle' font-size='30' fill='white' font-family='sans-serif'%3EColor Dash%3C/text%3E%3C/svg%3E">
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"VideoGame",
  "name":"Color Dash",
  "description":"A hyper-casual HTML5 game. Tap to flip between Sun and Moon modes, match color gates, grab bonuses, and build multiplier combos.",
  "genre":"Casual",
  "gamePlatform":"Web Browser",
  "applicationCategory":"Game",
  "operatingSystem":"Any",
  "url":"https://Balinti.github.io/color-dash/",
  "playMode":"SinglePlayer",
  "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}
}
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0b1020;font-family:'Segoe UI',system-ui,sans-serif;color:#eee;touch-action:none;user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent}
#wrap{position:relative;max-width:420px;width:100%;height:100vh;max-height:750px;margin:0 auto;overflow:hidden}
canvas{display:block;width:100%;height:100%}
#about{position:fixed;bottom:0;left:0;right:0;background:rgba(11,16,32,.96);max-width:420px;margin:0 auto;font-size:12px;line-height:1.5;z-index:10}
#about summary{padding:8px 14px;cursor:pointer;font-size:13px;color:#aaa}
#about .inner{padding:4px 14px 14px;color:#888;max-height:200px;overflow-y:auto}
@media(min-height:760px){#wrap{margin-top:calc((100vh - 750px)/2)}}
</style>
</head>
<body>
<div id="wrap"><canvas id="c"></canvas></div>
<details id="about">
<summary>About Color Dash</summary>
<div class="inner">
<p><strong>Color Dash</strong> is a free hyper-casual HTML5 game. Tap or press Space/Enter to flip between <em>Sun &#9728;</em> and <em>Moon &#9789;</em> modes. Match the correct gate to score points.</p>
<p>Grab risky <strong>bonus gates</strong> for multiplier combos and overdrive charge. Wrong gates break your shield energy. Lose all energy and it's game over!</p>
<p><strong>Controls:</strong> Tap the screen, or press Space / Enter to switch mode.</p>
<p><strong>Tips:</strong> Bonus gates are tighter but build your multiplier up to x8 and charge overdrive. Safe gates are wider with smaller rewards. Decoy gates appear later as visual tricks - they're faint and won't collide.</p>
<p><strong>Accessibility:</strong> Keyboard-friendly, high-contrast glyphs, works on mobile and desktop browsers.</p>
</div>
</details>
<script>
'use strict';
(function(){

/* ════ Helpers ════ */
var clamp=function(v,lo,hi){return v<lo?lo:v>hi?hi:v};
var lerp=function(a,b,t){return a+(b-a)*t};
var rand=function(lo,hi){return Math.random()*(hi-lo)+lo};
var hsl=function(h,s,l){return'hsl('+((h%360+360)%360)+','+s+'%,'+l+'%)'};
var hsla=function(h,s,l,a){return'hsla('+((h%360+360)%360)+','+s+'%,'+l+'%,'+a+')'};
var TAU=Math.PI*2;

/* ════ Constants ════ */
var LS_KEY='color_dash_highscore_v1';
var MAX_DPR=2;
var DESIGN_W=420,DESIGN_H=750;

var SUN_HUE=45,MOON_HUE=200;
var SUN_GLYPH='\u2600',MOON_GLYPH='\u263D';

var ENERGY_MAX=2;
var MULTI_MAX=8;
var OVERDRIVE_DUR=3.5;
var FLIP_CD=0.12;
var INPUT_BUFFER_WINDOW=0.14;
var GATE_WIN_SAFE=54;
var GATE_WIN_BONUS_BASE=36;

/* ════ Canvas ════ */
var canvas=document.getElementById('c');
var ctx=canvas.getContext('2d');
var wrap=document.getElementById('wrap');
var dpr=1,cw=DESIGN_W,ch=DESIGN_H,scaleX=1,scaleY=1;

function resize(){
  var r=wrap.getBoundingClientRect();
  cw=r.width;ch=r.height;
  dpr=Math.min(window.devicePixelRatio||1,MAX_DPR);
  canvas.width=Math.round(cw*dpr);
  canvas.height=Math.round(ch*dpr);
  scaleX=cw/DESIGN_W;
  scaleY=ch/DESIGN_H;
}
window.addEventListener('resize',resize);
resize();

/* ════ State ════ */
var state='start';
var score=0,best=0;
try{best=parseInt(localStorage.getItem(LS_KEY))||0}catch(e){}
var dist=0;
var mode=0; // 0=SUN, 1=MOON
var energy=ENERGY_MAX;
var multiplier=1;
var odCharge=0,odActive=false,odTimer=0;
var flipCD=0;
var lastInputT=0,inputBuffered=false;
var bgHue=220;
var gameTime=0;

/* Shake */
var shakeX=0,shakeY=0,shakeI=0;

/* Hitstop */
var hitstopT=0;

/* Gates */
var gates=[];
var gateSpawnAcc=0;
var gateId=0;

/* Particles */
var particles=[];

/* Player */
var PX=DESIGN_W/2,PY=DESIGN_H*0.82,PR=18;

/* ════ Mode helpers ════ */
function modeHue(){return mode===0?SUN_HUE:MOON_HUE}
function modeGlyph(){return mode===0?SUN_GLYPH:MOON_GLYPH}
function gateHue(m){return m===0?SUN_HUE:MOON_HUE}
function gateGlyph(m){return m===0?SUN_GLYPH:MOON_GLYPH}

/* ════ Difficulty ════ */
function diff(){
  var t=clamp(dist/28000,0,1);
  return{
    speed:lerp(2.4,5.8,t),
    interval:lerp(105,55,t),
    bonusOff:lerp(8,60,t),
    bonusWin:lerp(GATE_WIN_BONUS_BASE,18,clamp(t*1.4,0,1)),
    decoyP:lerp(0,0.38,clamp((t-0.2)/0.8,0,1))
  };
}

/* ════ Gate spawn ════ */
function spawnGate(){
  var d=diff();
  var isBonus=Math.random()<0.42;
  var gMode=Math.random()<0.5?0:1;
  var bOff=isBonus?d.bonusOff:0;
  var win=isBonus?d.bonusWin:GATE_WIN_SAFE;
  gates.push({
    id:gateId++,y:-65-bOff,
    mode:gMode,bonus:isBonus,
    win:win,scored:false,
    w:isBonus?rand(85,115):rand(125,170),
    decoy:false
  });
  if(d.decoyP>0&&Math.random()<d.decoyP){
    gates.push({
      id:gateId++,y:-65-rand(0,35),
      mode:Math.random()<0.5?0:1,
      bonus:false,win:GATE_WIN_SAFE,
      scored:true,w:rand(100,140),
      decoy:true
    });
  }
}

/* ════ Particles ════ */
function addP(x,y,vx,vy,life,col,sz){
  if(particles.length>300)return;
  particles.push({x:x,y:y,vx:vx,vy:vy,life:life,ml:life,col:col,sz:sz});
}
function emitTrail(){
  var h=modeHue();
  addP(PX+rand(-6,6),PY+rand(4,12),rand(-0.4,0.4),rand(0.8,2.2),rand(0.4,0.8),hsla(h,80,65,0.7),rand(2,4.5));
}
function emitClear(bonus){
  var n=bonus?30:14;var h=modeHue();
  for(var i=0;i<n;i++){
    var a=rand(0,TAU),sp=rand(1.5,bonus?7:4);
    addP(PX,PY,Math.cos(a)*sp,Math.sin(a)*sp,rand(0.5,1.1),hsla(h+rand(-30,30),90,60,0.9),rand(2,5.5));
  }
}
function emitShieldBreak(){
  for(var i=0;i<24;i++){
    var a=rand(0,TAU),sp=rand(2,6);
    addP(PX,PY,Math.cos(a)*sp,Math.sin(a)*sp,rand(0.45,0.9),hsla(0,90,55,0.9),rand(2.5,5));
  }
}
function emitOD(){
  for(var i=0;i<5;i++){
    addP(PX+rand(-16,16),PY+rand(-16,16),rand(-1.2,1.2),rand(-2.5,0.5),rand(0.3,0.6),hsla(rand(0,360),90,70,0.7),rand(2,4));
  }
}

/* ════ Shake ════ */
function shake(v){shakeI=Math.max(shakeI,v)}

/* ════ Input ════ */
function handleInput(e){
  if(e&&e.type==='keydown'){
    if(e.code!=='Space'&&e.code!=='Enter')return;
    e.preventDefault();
  }
  if(e&&e.type==='pointerdown')e.preventDefault();
  if(state==='start'){startGame();return}
  if(state==='gameover'){startGame();return}
  var now=performance.now()/1000;
  if(now-flipCD<FLIP_CD){
    inputBuffered=true;lastInputT=now;return;
  }
  doFlip(now);
}
function doFlip(now){
  mode=mode===0?1:0;
  flipCD=now||performance.now()/1000;
  inputBuffered=false;
}

wrap.addEventListener('pointerdown',handleInput);
document.addEventListener('keydown',handleInput);
document.addEventListener('touchmove',function(e){e.preventDefault()},{passive:false});

/* ════ Lifecycle ════ */
function startGame(){
  state='playing';score=0;dist=0;
  mode=0;energy=ENERGY_MAX;multiplier=1;
  odCharge=0;odActive=false;odTimer=0;
  gates=[];particles=[];
  gateSpawnAcc=0;gateId=0;
  shakeI=0;hitstopT=0;
  inputBuffered=false;gameTime=0;
  flipCD=0;lastInputT=0;
}
function gameOver(){
  state='gameover';
  if(score>best){best=score;try{localStorage.setItem(LS_KEY,String(best))}catch(e){}}
  shake(16);
}

/* ════ Update ════ */
function update(dt){
  if(hitstopT>0){hitstopT-=dt;return}

  bgHue+=dt*5;
  gameTime+=dt;

  // Input buffer
  if(inputBuffered){
    var now=performance.now()/1000;
    if(now-lastInputT<INPUT_BUFFER_WINDOW&&now-flipCD>=FLIP_CD){
      doFlip(now);
    }else if(now-lastInputT>=INPUT_BUFFER_WINDOW){
      inputBuffered=false;
    }
  }

  var d=diff();
  var spd=d.speed;
  if(odActive)spd*=1.15;

  // Distance + score
  dist+=spd*60*dt;
  var dScore=Math.floor(spd*0.13*multiplier*(odActive?2:1));
  score+=dScore;

  // Overdrive
  if(odActive){
    odTimer-=dt;
    emitOD();
    if(odTimer<=0){odActive=false;odTimer=0}
  }

  // Spawn
  gateSpawnAcc+=spd*60*dt;
  if(gateSpawnAcc>=d.interval){
    spawnGate();
    gateSpawnAcc-=d.interval;
  }

  // Move + collide gates
  for(var i=gates.length-1;i>=0;i--){
    var g=gates[i];
    g.y+=spd*60*dt/60;
    if(!g.scored&&!g.decoy){
      var dy=g.y-PY;
      if(Math.abs(dy)<g.win){
        g.scored=true;
        if(g.mode===mode){
          if(g.bonus){
            score+=Math.floor(30*multiplier);
            multiplier=Math.min(multiplier+1,MULTI_MAX);
            odCharge=clamp(odCharge+0.22,0,1);
            hitstopT=0.06;
            shake(5);
          }else{
            score+=Math.floor(10*multiplier);
          }
          emitClear(g.bonus);
          shake(g.bonus?5:2);
        }else{
          energy--;
          multiplier=1;
          emitShieldBreak();
          shake(9);
          if(energy<=0){gameOver();return}
        }
      }else if(dy>g.win+15){
        g.scored=true;
      }
    }
    if(g.y>DESIGN_H+90)gates.splice(i,1);
  }

  // OD activation
  if(!odActive&&odCharge>=1){
    odActive=true;odTimer=OVERDRIVE_DUR;odCharge=0;shake(6);
  }

  // Trail
  if(Math.random()<0.6)emitTrail();

  // Particles
  for(var j=particles.length-1;j>=0;j--){
    var p=particles[j];
    p.x+=p.vx;p.y+=p.vy;
    p.vy+=0.02; // tiny gravity
    p.life-=dt;
    if(p.life<=0)particles.splice(j,1);
  }

  // Shake decay
  if(shakeI>0.15){
    shakeX=rand(-shakeI,shakeI);
    shakeY=rand(-shakeI,shakeI);
    shakeI*=Math.pow(0.06,dt);
  }else{shakeX=shakeY=0;shakeI=0}
}

/* ════ Draw ════ */
function drawBG(){
  var h=(bgHue%360+360)%360;
  var g=ctx.createLinearGradient(0,0,0,DESIGN_H);
  g.addColorStop(0,hsl(h,30,9));
  g.addColorStop(0.5,hsl((h+18)%360,25,6));
  g.addColorStop(1,hsl((h+36)%360,20,4));
  ctx.fillStyle=g;
  ctx.fillRect(0,0,DESIGN_W,DESIGN_H);
}

function drawDotPat(x,y,w,h,hu){
  ctx.save();ctx.globalAlpha=0.2;
  var step=11;
  for(var px=x;px<x+w;px+=step){
    for(var py=y;py<y+h;py+=step){
      ctx.beginPath();ctx.arc(px+3,py+3,1.8,0,TAU);
      ctx.fillStyle=hsl(hu,60,70);ctx.fill();
    }
  }
  ctx.restore();
}
function drawStripePat(x,y,w,h,hu){
  ctx.save();ctx.globalAlpha=0.16;
  ctx.strokeStyle=hsl(hu,60,70);ctx.lineWidth=1.8;
  ctx.beginPath();
  var step=9;
  for(var d=-h;d<w+h;d+=step){
    ctx.moveTo(x+d,y);ctx.lineTo(x+d-h,y+h);
  }
  ctx.stroke();ctx.restore();
}

function drawGate(g){
  var gw=g.w;
  var gh=38;
  var gy=g.y-gh/2;
  var hu=gateHue(g.mode);
  var cx=DESIGN_W/2;

  ctx.save();
  if(g.decoy){
    ctx.globalAlpha=0.14+Math.sin(g.y*0.06)*0.06;
  }

  var barW=(DESIGN_W-gw)/2;

  // Left bar
  ctx.fillStyle=hsla(hu,65,g.bonus?45:35,g.bonus?0.9:0.7);
  ctx.fillRect(0,gy,barW+4,gh);

  // Right bar
  ctx.fillRect(DESIGN_W-barW-4,gy,barW+4,gh);

  // Gate opening border
  ctx.strokeStyle=hsl(hu,80,g.bonus?72:55);
  ctx.lineWidth=g.bonus?4.5:3;
  ctx.strokeRect(barW,gy,gw,gh);

  // Inner fill
  ctx.fillStyle=hsla(hu,50,g.bonus?25:18,0.5);
  ctx.fillRect(barW+2,gy+2,gw-4,gh-4);

  // Pattern
  if(g.mode===0){
    drawDotPat(barW+3,gy+3,gw-6,gh-6,hu);
  }else{
    drawStripePat(barW+3,gy+3,gw-6,gh-6,hu);
  }

  // Glyph
  ctx.font=(g.bonus?'bold 26px':'22px')+' sans-serif';
  ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillStyle=hsl(hu,85,g.bonus?82:66);
  ctx.fillText(gateGlyph(g.mode),cx,g.y);

  // Bonus label
  if(g.bonus&&!g.decoy){
    ctx.font='bold 10px sans-serif';
    ctx.fillStyle=hsl(hu,90,80);
    ctx.fillText('BONUS',cx,gy-7);
  }

  // Decoy shimmer
  if(g.decoy){
    ctx.font='9px sans-serif';
    ctx.fillStyle=hsla(hu,40,60,0.3);
    ctx.fillText('~',cx,g.y);
  }

  ctx.restore();
}

function drawPlayer(){
  var h=modeHue();

  // Glow
  var gr=ctx.createRadialGradient(PX,PY,PR*0.3,PX,PY,PR*2.8);
  gr.addColorStop(0,hsla(h,80,60,odActive?0.55:0.32));
  gr.addColorStop(1,hsla(h,80,60,0));
  ctx.fillStyle=gr;
  ctx.beginPath();ctx.arc(PX,PY,PR*2.8,0,TAU);ctx.fill();

  // Orb shadow
  ctx.fillStyle=hsla(h,60,20,0.4);
  ctx.beginPath();ctx.arc(PX+1,PY+2,PR+1,0,TAU);ctx.fill();

  // Orb
  ctx.fillStyle=hsl(h,75,55);
  ctx.beginPath();ctx.arc(PX,PY,PR,0,TAU);ctx.fill();

  // Inner highlight
  var ig=ctx.createRadialGradient(PX-4,PY-5,1,PX,PY,PR);
  ig.addColorStop(0,'rgba(255,255,255,0.35)');
  ig.addColorStop(1,'rgba(255,255,255,0)');
  ctx.fillStyle=ig;
  ctx.beginPath();ctx.arc(PX,PY,PR,0,TAU);ctx.fill();

  // Glyph
  ctx.font='bold 20px sans-serif';
  ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillStyle='#fff';
  ctx.fillText(modeGlyph(),PX,PY+1);

  // OD ring
  if(odActive){
    ctx.strokeStyle=hsla(((gameTime*200)%360),90,70,0.75);
    ctx.lineWidth=3;
    ctx.beginPath();ctx.arc(PX,PY,PR+7+Math.sin(gameTime*8)*3,0,TAU);ctx.stroke();
  }
}

function drawParticles(){
  for(var i=0;i<particles.length;i++){
    var p=particles[i];
    var t=clamp(p.life/p.ml,0,1);
    ctx.globalAlpha=t;
    ctx.fillStyle=p.col;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.sz*t,0,TAU);
    ctx.fill();
  }
  ctx.globalAlpha=1;
}

function drawHUD(){
  // Score
  ctx.font='bold 22px sans-serif';
  ctx.textAlign='center';ctx.textBaseline='top';
  ctx.fillStyle='#fff';
  ctx.fillText(score,DESIGN_W/2,14);

  // Best
  ctx.font='11px sans-serif';
  ctx.fillStyle='#999';
  ctx.fillText('BEST: '+best,DESIGN_W/2,40);

  // Multiplier
  if(multiplier>1){
    ctx.font='bold 16px sans-serif';
    ctx.fillStyle=hsl(modeHue(),90,72);
    ctx.textAlign='right';
    ctx.fillText('x'+multiplier,DESIGN_W-14,16);
  }

  // Current glyph
  ctx.font='28px sans-serif';
  ctx.textAlign='left';
  ctx.fillStyle=hsl(modeHue(),80,65);
  ctx.fillText(modeGlyph(),12,10);

  // Energy pips
  for(var i=0;i<ENERGY_MAX;i++){
    var ex=14+i*20;
    var ey=50;
    ctx.beginPath();ctx.arc(ex,ey,6,0,TAU);
    if(i<energy){
      ctx.fillStyle=hsl(130,70,50);ctx.fill();
      ctx.strokeStyle='rgba(255,255,255,0.3)';ctx.lineWidth=1.5;ctx.stroke();
    }else{
      ctx.fillStyle='rgba(255,255,255,0.1)';ctx.fill();
      ctx.strokeStyle='rgba(255,255,255,0.15)';ctx.lineWidth=1;ctx.stroke();
    }
  }
  ctx.font='8px sans-serif';ctx.textAlign='left';ctx.fillStyle='#666';
  ctx.fillText('SHIELD',12,62);

  // Overdrive bar
  var bw=82,bh=7;
  var bx=DESIGN_W-bw-14,by=44;
  ctx.fillStyle='rgba(255,255,255,0.08)';
  ctx.fillRect(bx,by,bw,bh);
  var charge=odActive?1:odCharge;
  ctx.fillStyle=odActive?hsl(((gameTime*120)%360),90,60):hsl(48,80,52);
  ctx.fillRect(bx,by,bw*charge,bh);
  ctx.strokeStyle='rgba(255,255,255,0.15)';ctx.lineWidth=1;
  ctx.strokeRect(bx,by,bw,bh);
  ctx.font='8px sans-serif';ctx.textAlign='right';ctx.fillStyle='#666';
  ctx.fillText(odActive?'OVERDRIVE':'CHARGE',DESIGN_W-14,by+bh+10);
}

function drawStartScreen(){
  drawBG();

  // Floating glyphs animation
  var t=gameTime;
  ctx.save();
  ctx.globalAlpha=0.15;
  for(var i=0;i<6;i++){
    var fx=DESIGN_W*0.15+i*(DESIGN_W*0.14);
    var fy=DESIGN_H*0.35+Math.sin(t*1.2+i*1.1)*30;
    ctx.font='32px sans-serif';ctx.textAlign='center';
    ctx.fillStyle=hsl(i%2===0?SUN_HUE:MOON_HUE,70,60);
    ctx.fillText(i%2===0?SUN_GLYPH:MOON_GLYPH,fx,fy);
  }
  ctx.restore();

  // Title
  ctx.font='bold 44px sans-serif';
  ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillStyle='#fff';
  ctx.fillText('Color Dash',DESIGN_W/2,DESIGN_H*0.24);

  // Subtitle
  ctx.font='16px sans-serif';
  ctx.fillStyle='#aaa';
  ctx.fillText('Glyph Glide',DESIGN_W/2,DESIGN_H*0.24+34);

  // Mode icons
  ctx.font='52px sans-serif';
  ctx.fillStyle=hsl(SUN_HUE,80,65);
  ctx.fillText(SUN_GLYPH,DESIGN_W/2-42,DESIGN_H*0.44);
  ctx.fillStyle=hsl(MOON_HUE,80,65);
  ctx.fillText(MOON_GLYPH,DESIGN_W/2+42,DESIGN_H*0.44);

  // Instructions
  ctx.font='15px sans-serif';
  ctx.fillStyle='#bbb';
  ctx.fillText('Tap to flip between Sun & Moon',DESIGN_W/2,DESIGN_H*0.555);
  ctx.font='12px sans-serif';ctx.fillStyle='#888';
  ctx.fillText('Match gates \u2022 Grab bonuses \u2022 Build combos',DESIGN_W/2,DESIGN_H*0.59);

  // Tap prompt
  var pulse=0.5+Math.sin(gameTime*4)*0.5;
  ctx.globalAlpha=0.4+pulse*0.6;
  ctx.font='21px sans-serif';
  ctx.fillStyle='#fff';
  ctx.fillText('Tap to Start',DESIGN_W/2,DESIGN_H*0.70);
  ctx.globalAlpha=1;

  if(best>0){
    ctx.font='13px sans-serif';ctx.fillStyle='#777';
    ctx.fillText('Best: '+best,DESIGN_W/2,DESIGN_H*0.78);
  }

  ctx.font='11px sans-serif';ctx.fillStyle='#555';
  ctx.fillText('Space / Enter / Tap',DESIGN_W/2,DESIGN_H*0.86);
}

function drawGameOverScreen(){
  drawBG();
  drawParticles();

  ctx.font='bold 38px sans-serif';
  ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillStyle='#e55';
  ctx.fillText('Game Over',DESIGN_W/2,DESIGN_H*0.25);

  ctx.font='bold 56px sans-serif';
  ctx.fillStyle='#fff';
  ctx.fillText(score,DESIGN_W/2,DESIGN_H*0.38);

  ctx.font='14px sans-serif';
  ctx.fillStyle='#aaa';
  ctx.fillText('SCORE',DESIGN_W/2,DESIGN_H*0.445);

  ctx.font='bold 28px sans-serif';
  ctx.fillStyle=score>=best?hsl(50,90,65):'#ccc';
  ctx.fillText(best,DESIGN_W/2,DESIGN_H*0.54);

  ctx.font='13px sans-serif';
  ctx.fillStyle=score>=best?hsl(50,80,70):'#888';
  ctx.fillText(score>=best?'NEW BEST!':'BEST',DESIGN_W/2,DESIGN_H*0.59);

  var pulse=0.4+Math.sin(gameTime*4)*0.6;
  ctx.globalAlpha=clamp(pulse,0.3,1);
  ctx.font='20px sans-serif';
  ctx.fillStyle='#fff';
  ctx.fillText('Tap to Retry',DESIGN_W/2,DESIGN_H*0.73);
  ctx.globalAlpha=1;
}

/* ════ Main Loop ════ */
var lastT=0;
function frame(ts){
  requestAnimationFrame(frame);
  var dt=lastT?(ts-lastT)/1000:1/60;
  lastT=ts;
  if(dt>0.08)dt=0.08;
  gameTime+=dt;

  // Always update shake + particles in gameover
  if(state==='gameover'){
    // Shake decay
    if(shakeI>0.15){
      shakeX=rand(-shakeI,shakeI);shakeY=rand(-shakeI,shakeI);
      shakeI*=Math.pow(0.04,dt);
    }else{shakeX=shakeY=0;shakeI=0}
    // Particles
    for(var j=particles.length-1;j>=0;j--){
      var pp=particles[j];
      pp.x+=pp.vx;pp.y+=pp.vy;pp.vy+=0.02;
      pp.life-=dt;
      if(pp.life<=0)particles.splice(j,1);
    }
    bgHue+=dt*5;
  }

  if(state==='playing')update(dt);

  // Render
  ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.save();
  // Scale to design coords
  ctx.scale(scaleX,scaleY);
  ctx.translate(shakeX,shakeY);

  if(state==='start'){
    drawStartScreen();
  }else if(state==='playing'){
    drawBG();
    for(var i=0;i<gates.length;i++)drawGate(gates[i]);
    drawParticles();
    drawPlayer();
    drawHUD();
  }else if(state==='gameover'){
    drawGameOverScreen();
  }

  ctx.restore();
}
requestAnimationFrame(frame);

})();
</script>
</body>
</html>
